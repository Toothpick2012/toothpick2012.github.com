<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ios | Toothpick&#39;s blog</title>
  <meta name="author" content="toothpickv">
  
  <meta name="description" content="言有物，行有恒">
  
  
  
  <meta property="og:site_name" content="Toothpick&#39;s blog"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta property="og:image" content="undefined"/>
  
   <link rel="apple-touch-icon" href="/icon.png" />
   <link rel="shortcut icon" href="/favicon.png" >
   <link rel="alternate" href="/atom.xml" title="Toothpick&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
</head>


<body>
  <div id="content" class="inner">
    <aside id="sidebar" class="alignleft">
      <div class="navigationBar">
        <a href="/">Toothpick&#39;s blog</a>
      </div>
    	
  <nav class="widget" id="menu">
	<ul>
    
      <li class="cell"><a class="next" href="/">首页</a><li>
    
      <li class="cell"><a class="next" href="/archives/">归档</a><li>
    
      <li class="cell"><a class="next" href="/about/">关于</a><li>
    
      <li class="cell"><a class="next" href="/atom.xml">订阅</a><li>
    
    </ul>
</nav>

  <div class="widget search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="text" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:toothpick2012.github.io/">
  </form>
</div>

  <div class="widget weibo">
<iframe width="100%" height="100" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=100&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=1&isWeibo=0&isFans=0&uid=2049029440&verifier=b3a5339e&dpc=1"></iframe>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/CSS/">CSS</a><small>1</small></li>
  
    <li><a href="/categories/IOS/">IOS</a><small>10</small></li>
  
    <li><a href="/categories/IOS类库/">IOS类库</a><small>2</small></li>
  
    <li><a href="/categories/PHP/">PHP</a><small>1</small></li>
  
    <li><a href="/categories/blog/">blog</a><small>1</small></li>
  
    <li><a href="/categories/coretext/">coretext</a><small>4</small></li>
  
    <li><a href="/categories/mac/">mac</a><small>2</small></li>
  
    <li><a href="/categories/插件/">插件</a><small>1</small></li>
  
    <li><a href="/categories/音乐/">音乐</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/Ad Hoc/" style="font-size: 15.00px;">Ad Hoc</a><a href="/tags/AppStore/" style="font-size: 15.00px;">AppStore</a><a href="/tags/CSS/" style="font-size: 10.00px;">CSS</a><a href="/tags/JDK/" style="font-size: 10.00px;">JDK</a><a href="/tags/Objective-C/" style="font-size: 17.50px;">Objective-C</a><a href="/tags/SASS/" style="font-size: 10.00px;">SASS</a><a href="/tags/SDWebImage/" style="font-size: 10.00px;">SDWebImage</a><a href="/tags/UIApplicationDelegate/" style="font-size: 10.00px;">UIApplicationDelegate</a><a href="/tags/UIImage/" style="font-size: 10.00px;">UIImage</a><a href="/tags/blog/" style="font-size: 10.00px;">blog</a><a href="/tags/bug/" style="font-size: 10.00px;">bug</a><a href="/tags/class cluster/" style="font-size: 10.00px;">class cluster</a><a href="/tags/ios/" style="font-size: 20.00px;">ios</a><a href="/tags/itunes/" style="font-size: 15.00px;">itunes</a><a href="/tags/java/" style="font-size: 10.00px;">java</a><a href="/tags/jekyll/" style="font-size: 10.00px;">jekyll</a><a href="/tags/mac/" style="font-size: 10.00px;">mac</a><a href="/tags/occurred uploading/" style="font-size: 10.00px;">occurred uploading</a><a href="/tags/uitableview/" style="font-size: 10.00px;">uitableview</a><a href="/tags/优化/" style="font-size: 15.00px;">优化</a><a href="/tags/保存数据/" style="font-size: 10.00px;">保存数据</a><a href="/tags/后台/" style="font-size: 10.00px;">后台</a><a href="/tags/基础/" style="font-size: 10.00px;">基础</a><a href="/tags/开发者/" style="font-size: 15.00px;">开发者</a><a href="/tags/类库/" style="font-size: 12.50px;">类库</a><a href="/tags/类簇/" style="font-size: 10.00px;">类簇</a><a href="/tags/苹果/" style="font-size: 12.50px;">苹果</a><a href="/tags/账号/" style="font-size: 12.50px;">账号</a><a href="/tags/进阶/" style="font-size: 10.00px;">进阶</a><a href="/tags/闪退/" style="font-size: 12.50px;">闪退</a><a href="/tags/高效/" style="font-size: 15.00px;">高效</a>
  </div>
</div>


    	<footer id="footer" class="inner"><div class="copyright">
  
  &copy; 2014 toothpickv
  
</div>



</footer>
    </aside>
    
    
    <div id="hidden-navigationBar" class="navigationBar">
      <a href="/">Toothpick&#39;s blog</a>
    </div>
    <div id="main-col" class="alignright">
    <div id="wrapper">
      
<h2 class="archive-title tag">ios</h2>


  
    
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/2014/03/11/类簇在iOS开发中的应用/">类簇在iOS开发中的应用(转)</a></h1>
  

      <time datetime="2014-03-11T09:06:40.000Z"><a href="/2014/03/11/类簇在iOS开发中的应用/">3月 11 2014</a></time>
      
  </header>
    <div class="entry">
      
        <p>类簇(class cluster)是一种设计模式，在Foundation Framework中被广泛使用，举个简单的例子</p>
<figure class="highlight Objective-C"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="built_in">NSArray</span> *arr = [<span class="built_in">NSArray</span> arrayWithObjects:@<span class="string">"foo"</span>,@<span class="string">"bar"</span>, <span class="literal">nil</span>]; 
<span class="built_in">NSLog</span>(@<span class="string">"arr class:%@"</span>, [arr class]); 
<span class="comment">// output: __NSArrayI</span>
</pre></td></tr></table></figure>

<p>显然__NSArrayI是一个私有类，来看看这个类的头文件</p>
<figure class="highlight Objective-C"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>@interface __NSArrayI : NSArray { 
    unsigned int _used; 
} 
//<span class="keyword">...</span>
</pre></td></tr></table></figure>


<p>可以看出__NSArrayI继承了NSArray。为什么要这么设计呢？拿NSNumber来举个例子，我们都知道NSNumber可以存储多种类型的数字，如Int/Float/Double等等，一种方式是把NSNumber作为基类，然后分别去实现各自的子类，像这样：<br> ![此处输入图片的描述][1]<br>初看起来也没什么问题，但如果子类很多，像这样：<br>![此处输入图片的描述][2]</p>
<p>这对使用者来说显然不够方便，得记住这么多类。如果使用类簇，问题就变得简单了，把Number作为抽象基类，子类各自实现存取方式，然后在基类中定义多个初始化方式，像这样：<br>![此处输入图片的描述][3]</p>
<p>现在只需要记住一个类就可以了。NSNumber的初始化伪代码大概像这样：</p>
<figure class="highlight Objective-C"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre>- (id)initWithBool 
{ 
    <span class="keyword">return</span> [[__NSCFBoolean alloc]init]; 
} 
 
- (id)initWithLong 
{ 
    <span class="keyword">return</span> [[__NSCFNumber alloc]init]; 
} 
 
//<span class="keyword">...</span>
</pre></td></tr></table></figure>

<h1 id="在iOS项目中的应用">在iOS项目中的应用</h1>
<hr>
<p>在开发app时经常会遇到表现和行为完全一样，但数据源不一样的情况。以花瓣app为例，同样是瀑布流，可能来自我喜欢的图片、某个画板下的图片、某个用户的图片等等。如果为每一种表现方式都新建一个Controller，并且使用这个Controller来初始化，那么就会遇到最开始提到的问题：子类太多，使用不便。这正好可以通过类簇来很方便地搞定。比如这样：</p>
<figure class="highlight Objective-C"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre><span class="class"><span class="keyword">@implementation</span> <span class="title">HBWaterfallViewController</span> </span>
- (<span class="keyword">id</span>)initWithLiked 
{ 
    <span class="keyword">return</span> [[HBLikedViewController alloc]init]; 
} 
  
- (<span class="keyword">id</span>)initWithBoardID:(<span class="built_in">NSInteger</span>)boardID 
{ 
    <span class="keyword">return</span> [[HBBoardViewController alloc]initWithBoardID:boardID]; 
}
</pre></td></tr></table></figure>

<h2 id="pragma_mark_-_通用的方法">pragma mark - 通用的方法</h2>
<figure class="highlight Objective-C"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>- (PSUICollectionViewCell *)collectionView:(PSUICollectionView *)collectionView 
                    cellForItemAtIndexPath:(NSIndexPath *)indexPath 
{ 
    // <span class="keyword">...</span> 
} 
  
// <span class="keyword">...</span>
</pre></td></tr></table></figure>

<h2 id="pragma_mark_-_每个子类需要实现的方法">pragma mark - 每个子类需要实现的方法</h2>
<figure class="highlight Objective-C"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="pp">- <span class="params">(void)</span>fetchMoreData 
{ 
    NSAssert<span class="params">(<span class="variable">NO</span>, @<span class="string">"子类需要实现此方法"</span>)</span>; 
}</span>
</pre></td></tr></table></figure>

<p>使用起来类似这样[[HBWaterfallViewController alloc]initWithBoardID:9527] 或 [[HBWaterfallViewController alloc]initWithLiked]。如果有新的DataSource，新加一个初始化方法即可，对于使用者来说，打开头文件，看下init开头的方法就行了。</p>
<p>再举个例子，现在很多应用需要同时兼顾iOS6和iOS7，在表现上需要为不同的系统加载不同的图片资源，最简单粗暴的方法就是各种if/else判断，像这样：</p>
<figure class="highlight Objective-C"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="tag">if</span> (<span class="attr_selector">[[UIDevice currentDevice]</span><span class="tag">systemMajorVersion</span>] &lt; 7) 
<span class="rules">{ 
    <span class="comment">/* iOS 6 and previous versions */</span> 
<span class="rule">}</span></span> 
<span class="tag">else</span> 
<span class="rules">{ 
    <span class="comment">/* iOS 7 and above */</span> 
<span class="rule">}</span></span>
</pre></td></tr></table></figure>

<p>不够优雅，可以使用类簇的思想来去掉if/else判断，把跟视图具体元素无关的代码放在基类，跟系统版本相关的代码拆成两个子类，然后在各自的类中加载相应的资源。</p>
<figure class="highlight Objective-C"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="code"><pre><span class="comment">/* TestView.h */</span> 
<span class="class"><span class="keyword">@interface</span> <span class="title">TestView</span>: <span class="title">UIView</span> </span>
 
<span class="comment">/* Common method */</span> 
- ( <span class="keyword">void</span> )test; 
 
<span class="keyword">@end</span> 
 
<span class="comment">/* TestView.m */</span> 
<span class="class"><span class="keyword">@implementation</span> <span class="title">TestView</span> </span>
 
+ (<span class="keyword">id</span>)alloc 
{ 
    <span class="keyword">if</span> ([<span class="keyword">self</span> class]== [TestView class]) 
    { 
        <span class="keyword">if</span> ([[UIDevice currentDevice] systemMajorVersion] &lt; <span class="number">7</span>) 
        { 
            <span class="keyword">return</span> [TestViewIOS6 alloc]; 
        } 
        <span class="keyword">else</span> 
        { 
            <span class="keyword">return</span> [TestViewIOS7 alloc]; 
        } 
    } 
    <span class="keyword">else</span> 
    { 
        <span class="keyword">return</span> [<span class="keyword">super</span> alloc]; 
    } 
} 
 
- ( <span class="keyword">void</span> )test 
{} 
 
<span class="keyword">@end</span>
</pre></td></tr></table></figure>

<p>这里alloc时并没有返回TestView类，而是根据系统版本返回TestViewIOS6 或 TestViewIOS7。</p>
<figure class="highlight Objective-C"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre><span class="comment">/* TestViewIOS6.m */</span> 
<span class="class"><span class="keyword">@implementation</span> <span class="title">TestViewIOS6</span>: <span class="title">TestView</span> </span>
 
- (<span class="keyword">void</span>)drawRect: (<span class="built_in">CGRect</span>)rect 
{ 
    <span class="comment">/* Custom iOS6 drawing code */</span> 
} 
 
<span class="keyword">@end</span> 
 
<span class="comment">/* TestViewIOS7.m */</span> 
<span class="class"><span class="keyword">@implementation</span> <span class="title">TestViewIOS7</span> </span>
 
- (<span class="keyword">void</span>)drawRect: (<span class="built_in">CGRect</span>)rect 
{ 
    <span class="comment">/* Custom iOS7 drawing code */</span> 
} 
 
<span class="keyword">@end</span>
</pre></td></tr></table></figure>

<h1 id="小结">小结</h1>
<hr>
<p>类簇的本质其实是抽象工厂，类簇也可以有多个基类，如NSArray, NSMutableArray, 后者就是继承的前者。它对一些「大同小异」的问题，往往会有不错的效果。</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/u/2049029440"><strong>牙-_签</strong></a> - 3月 11 2014</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://toothpick2012.github.io/"><strong>Toothpick&#39;s blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/2014/03/11/减少上线应用的崩溃情况/">减少上线应用的崩溃情况</a></h1>
  

      <time datetime="2014-03-11T06:42:55.000Z"><a href="/2014/03/11/减少上线应用的崩溃情况/">3月 11 2014</a></time>
      
  </header>
    <div class="entry">
      
        <p>应用上线后，在umeng或是百度移动统计里面经常会有NSRangeException，NSInvalidArgumentException等这类错误，而且通常都是占据了很大比例。<br>你能看到的错误详情可能是这样：(很庆幸我们还是可以找到具体出错的位置，但是上千个类似错误成分散分布在不同位置，那就别扯蛋了！！)</p>
<figure class="highlight Objective-C"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>*** Terminating app due to uncaught exception <span class="string">'NSRangeException'</span>, reason: <span class="string">'*** -[__NSArrayM objectAtIndex:]: index 0 beyond bounds for empty array'</span>
详细错误信息:
 ....
<span class="number">2</span>   CoreFoundation                      <span class="number">0x2f20dd95</span> -[__NSArrayM objectAtIndex:] + <span class="number">232</span>
<span class="number">3</span>   nineteenlou                         <span class="number">0x001357a7</span> -[UserViewController tableView:didSelectRowAtIndexPath:] + <span class="number">158</span>
<span class="number">4</span>   UIKit                               <span class="number">0x31b790cb</span> -[UITableView _selectRowAtIndexPath:animated:scrollPosition:notifyDelegate:] + <span class="number">1078</span>
<span class="number">5</span>   UIKit                               <span class="number">0x31c2c863</span> -[UITableView _userSelectRowAtPendingSelectionIndexPath:] + <span class="number">214</span>
<span class="keyword">...</span>
</pre></td></tr></table></figure>

<p>发生错误原因，有的是多线程block造成的，还有接口返回数据解析问题，还有其他乱七八糟问题。<br>应用的体验是建立在不崩溃的基础之上的。如果是这样，那必须动武的啦。最佳的方法，就是用swizzle替换数组的方法，判断越界等出现崩溃的情况。</p>
<p>OK，废话多了，自写的个类SafeMode，上代码吧。<br>也可以下载例子:<a href="https://github.com/Toothpick2012/SafeMode" target="_blank">https://github.com/Toothpick2012/SafeMode</a></p>
<p>SafeMode.h</p>
<figure class="highlight Objective-C"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre>#import &lt;Foundation/Foundation.h&gt;
#import &lt;objc/runtime.h&gt;

@<span class="keyword">interface</span> SafeMode:NSObject
+ (void)safe;
+ (void)exchangeOriginalMethod:(<span class="function"><span class="keyword">Method</span>)<span class="title">originalMethod</span> <span class="title">withNewMethod</span>:</span>(<span class="function"><span class="keyword">Method</span>)<span class="title">newMethod</span>;</span>
@<span class="keyword">end</span>

@<span class="keyword">interface</span> NSArray (Safe)
+ (<span class="function"><span class="keyword">Method</span>)<span class="title">methodOfSelector</span>:</span>(SEL)<span class="keyword">selector</span>;
- (id)objectAtIndexOrNil:(NSUInteger)<span class="keyword">index</span>;
@<span class="keyword">end</span>


@<span class="keyword">interface</span> NSMutableArray (Safe)
+ (<span class="function"><span class="keyword">Method</span>)<span class="title">methodOfSelector</span>:</span>(SEL)<span class="keyword">selector</span>;
- (id)objectAtIndexOrNilM:(NSUInteger)<span class="keyword">index</span>;
- (void)safe_replaceObjectAtIndex:(NSUInteger)<span class="keyword">index</span> withObject:(id)anObject;
@<span class="keyword">end</span>
</pre></td></tr></table></figure>

<p>SafeMode.m</p>
<figure class="highlight Objective-C"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre></td><td class="code"><pre><span class="preprocessor">#import <span class="title">"SafeMode.h"</span></span>

<span class="class"><span class="keyword">@implementation</span> <span class="title">SafeMode</span></span>

+ (<span class="keyword">void</span>)safe
{
    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;
    <span class="built_in">dispatch_once</span>(&onceToken, ^{
        <span class="comment">//NSArray</span>
        [<span class="keyword">self</span> exchangeOriginalMethod:[<span class="built_in">NSArray</span> methodOfSelector:<span class="keyword">@selector</span>(objectAtIndex:)] withNewMethod:[<span class="built_in">NSArray</span> methodOfSelector:<span class="keyword">@selector</span>(objectAtIndexOrNil:)]];
        
        <span class="comment">//NSMutableArray</span>
        [<span class="keyword">self</span> exchangeOriginalMethod:[<span class="built_in">NSMutableArray</span> methodOfSelector:<span class="keyword">@selector</span>(objectAtIndex:)] withNewMethod:[<span class="built_in">NSMutableArray</span> methodOfSelector:<span class="keyword">@selector</span>(objectAtIndexOrNilM:)]];
        [<span class="keyword">self</span> exchangeOriginalMethod:[<span class="built_in">NSMutableArray</span> methodOfSelector:<span class="keyword">@selector</span>(replaceObjectAtIndex:withObject:)] withNewMethod:[<span class="built_in">NSMutableArray</span> methodOfSelector:<span class="keyword">@selector</span>(safe_replaceObjectAtIndex:withObject:)]];
}

+ (<span class="keyword">void</span>)exchangeOriginalMethod:(Method)originalMethod withNewMethod:(Method)newMethod
{
    method_exchangeImplementations(originalMethod, newMethod);
}

<span class="keyword">@end</span>

<span class="class"><span class="keyword">@implementation</span> <span class="title">NSArray</span> (<span class="title">Safe</span>)</span>

<span class="preprocessor">#pragma mark - NSArray</span>
+ (Method)methodOfSelector:(SEL)selector
{
    <span class="keyword">return</span> class_getInstanceMethod(NSClassFromString(@<span class="string">"__NSArrayI"</span>),selector);
}


- (<span class="keyword">id</span>)objectAtIndexOrNil:(NSUInteger)index
{
    <span class="keyword">return</span> (index &lt; [<span class="keyword">self</span> count]) ? [<span class="keyword">self</span> objectAtIndexOrNil:index] : <span class="literal">nil</span>;
}

<span class="keyword">@end</span>


<span class="class"><span class="keyword">@implementation</span> <span class="title">NSMutableArray</span> (<span class="title">Safe</span>)</span>


<span class="preprocessor">#pragma mark - NSMutableArray</span>
+ (Method)methodOfSelector:(SEL)selector
{
    <span class="keyword">return</span> class_getInstanceMethod(NSClassFromString(@<span class="string">"__NSArrayM"</span>),selector);
}

- (<span class="keyword">id</span>)objectAtIndexOrNilM:(NSUInteger)index
{
    <span class="keyword">return</span> (index &lt; [<span class="keyword">self</span> count]) ? [<span class="keyword">self</span> objectAtIndexOrNilM:index] : <span class="literal">nil</span>;
}

- (<span class="keyword">void</span>)safe_replaceObjectAtIndex:(NSUInteger)index withObject:(<span class="keyword">id</span>)anObject
{
    <span class="keyword">if</span> ((index &lt; [<span class="keyword">self</span> count])&&anObject) {
        [<span class="keyword">self</span> safe_replaceObjectAtIndex:index withObject:anObject];
    }
}

<span class="keyword">@end</span>
</pre></td></tr></table></figure>

<p>当然，还有其他类似的问题可以在类里面添加方法。这样，上线应用可以避免出现崩溃。另外数组的objectAtIndex:方法的类不是NSArray，而是__NSArrayI，这个可以参考<a href="http://toothpick2012.github.com/2014/03/11/%E7%B1%BB%E7%B0%87%E5%9C%A8iOS%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/" target="_blank">类簇在iOS开发中的应用</a></p>
<p><strong><em>ps：测试时最好不开启，免得一些bug难以发现。</em></strong></p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/u/2049029440"><strong>牙-_签</strong></a> - 3月 11 2014</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://toothpick2012.github.io/"><strong>Toothpick&#39;s blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/2013/03/25/calayer与uiview的关系/">CALayer与UIView的关系</a></h1>
  

      <time datetime="2013-03-25T05:36:49.000Z"><a href="/2013/03/25/calayer与uiview的关系/">3月 25 2013</a></time>
      
  </header>
    <div class="entry">
      
        <p>CALayer属于Core Animation部分的内容，比较重要而不太好理解。以下是园子中看到的一篇文章的摘录：</p>
<p><span style="word-wrap:normal;word-break:normal;margin:0px;padding:0px;">1. UIView是iOS系统中界面元素的基础</span>，所有的界面元素都是继承自它。它本身完全是由CoreAnimation来实现的。<span style="word-wrap:normal;word-break:normal;margin:0px;padding:0px;">它真正的绘图部分，是由一个CALayer类来管理</span>。UIView本身更像是一个CALayer的管理器，访问它的跟绘图和跟坐标有关的属性，例如frame，bounds等，实际上内部都是在访问它所包含的CALayer的相关属性。</p>
<p><span style="word-wrap:normal;word-break:normal;margin:0px;padding:0px;">2. UIView有个重要属性layer，可以返回它的主CALayer实例。<br></span></p>
<div style="font-size:14px;color:#333333;line-height:26px;background-color:#ffffff;margin:5px 0px;padding:5px;font-family:&#39;courier new&#39;;border:1px solid #cccccc;overflow:auto;"><pre style="word-wrap:break-word;padding:0px;font-family:&#39;courier new&#39;;margin-top:0px;margin-bottom:0px;"><span style="word-wrap:normal;word-break:normal;line-height:21px;margin:0px;padding:0px;color:#008000;">//</span><span style="word-wrap:normal;word-break:normal;line-height:21px;margin:0px;padding:0px;color:#008000;"> 要访问层，读取UIView实例的layer属性</span><span style="word-wrap:normal;word-break:normal;line-height:21px;margin:0px;padding:0px;color:#008000;"><br></span>CALayer *layer = myView.layer<br></pre></div>

<p>所有从UIView继承来的对象都继承了这个属性。这意味着你可以转换、缩放、旋转，甚至可以在Navigation bars，Tables，Text boxes等其它的View类上增加动画。每个UIView都有一个层，控制着各自的内容最终被显示在屏幕上的方式。<br>UIView的layerClass方法，可以返回主layer所使用的类，UIView的子类可以通过重载这个方法，来让UIView使用不同的CALayer来显示。代码示例：</p>
<div style="font-size:14px;color:#333333;line-height:26px;background-color:#ffffff;margin:5px 0px;padding:5px;font-family:&#39;courier new&#39;;border:1px solid #cccccc;overflow:auto;"><pre style="word-wrap:break-word;padding:0px;font-family:&#39;courier new&#39;;margin-top:0px;margin-bottom:0px;">- (<span style="word-wrap:normal;word-break:normal;line-height:21px;margin:0px;padding:0px;color:#0000ff;">class</span>)layerClass {<br><span style="word-wrap:normal;word-break:normal;line-height:21px;margin:0px;padding:0px;color:#0000ff;">return</span> ([CAEAGLLayer <span style="word-wrap:normal;word-break:normal;line-height:21px;margin:0px;padding:0px;color:#0000ff;">class</span>]);<br><br>}<br></pre></div>

<p>上述代码使得某个UIView的子类使用GL来进行绘制。</p>
<p><span style="word-wrap:normal;word-break:normal;margin:0px;padding:0px;">3. UIView的CALayer类似UIView的子View树形结构</span>，也可以向它的layer上添加子layer，来完成某些特殊的表示。即CALayer层是可以嵌套的。示例代码：</p>
<div style="font-size:14px;color:#333333;line-height:26px;background-color:#ffffff;margin:5px 0px;padding:5px;font-family:&#39;courier new&#39;;border:1px solid #cccccc;overflow:auto;"><pre style="word-wrap:break-word;padding:0px;font-family:&#39;courier new&#39;;margin-top:0px;margin-bottom:0px;">grayCover = [[CALayer alloc] init];<br><br>grayCover.backgroundColor = [[UIColor blackColor] colorWithAlphaComponent:<span style="word-wrap:normal;word-break:normal;line-height:21px;margin:0px;padding:0px;color:#800080;">0.2</span>] CGColor];<br><br>[self.layer addSubLayer:grayCover];<br></pre></div>

<p>上述代码会在目标View上敷上一层黑色透明薄膜的效果。</p>
<p><span style="word-wrap:normal;word-break:normal;margin:0px;padding:0px;">4. UIView的layer树形在系统内部，被维护着三份copy。</span>分别是逻辑树，这里是代码可以操纵的；动画树，是一个中间层，系统就在这一层上更改属性，进行各种渲染操作；显示树，其内容就是当前正被显示在屏幕上得内容。</p>
<p><span style="word-wrap:normal;word-break:normal;margin:0px;padding:0px;">5. 动画的运作：对UIView的subLayer（非主Layer）属性进行更改，系统将自动进行动画生成</span>，动画持续时间的缺省值似乎是0.5秒。</p>
<p><span style="word-wrap:normal;word-break:normal;margin:0px;padding:0px;">6. 坐标系统：CALayer的坐标系统比UIView多了一个anchorPoint属性，使用CGPoint结构表示，值域是0~1，是个比例值。</span>这个点是各种图形变换的坐标原点，同时会更改layer的position的位置，它的缺省值是{0.5,0.5}，即在layer的中央。<br>某layer.anchorPoint = CGPointMake(0.f,0.f);<br>如果这么设置，只会将layer的左上角被挪到原来的中间位置，必须加上这一句：<br>某layer.position = CGPointMake(0.f,0.f);</p>
<p>最后：layer可以设置圆角显示（cornerRadius），也可以设置阴影 <wbr>(shadowColor)。但是如果layer树中某个layer设置了圆角，树种所有layer的阴影效果都将不显示了。因此若是要有圆角又要阴影，变通方法只能做两个重叠的UIView，一个的layer显示圆角，一个layer显示阴影……</wbr></p>
<p><span style="word-wrap:normal;word-break:normal;line-height:24px;margin:0px;padding:0px;font-size:16px;"><span style="word-wrap:normal;word-break:normal;margin:0px;padding:0px;">7.渲染</span>：</span>当更新层，改变不能立即显示在屏幕上。当所有的层都准备好时，可以调用setNeedsDisplay方法来重绘显示。</p>
<div style="font-size:14px;color:#333333;line-height:26px;background-color:#ffffff;margin:5px 0px;padding:5px;font-family:&#39;courier new&#39;;border:1px solid #cccccc;overflow:auto;"><pre style="word-wrap:break-word;padding:0px;font-family:&#39;courier new&#39;;margin-top:0px;margin-bottom:0px;">[gameLayer setNeedsDisplay];<br></pre></div>

<p>若要重绘部分屏幕区域，请使用setNeedsDisplayInRect:方法，通过在CGRect结构的区域更新：</p>
<div style="font-size:14px;color:#333333;line-height:26px;background-color:#ffffff;margin:5px 0px;padding:5px;font-family:&#39;courier new&#39;;border:1px solid #cccccc;overflow:auto;"><pre style="word-wrap:break-word;padding:0px;font-family:&#39;courier new&#39;;margin-top:0px;margin-bottom:0px;">[gameLayer setNeedsDisplayInRect:CGRectMake(<span style="word-wrap:normal;word-break:normal;line-height:21px;margin:0px;padding:0px;color:#800080;">150.0</span>,<span style="word-wrap:normal;word-break:normal;line-height:21px;margin:0px;padding:0px;color:#800080;">100.0</span>,<span style="word-wrap:normal;word-break:normal;line-height:21px;margin:0px;padding:0px;color:#800080;">50.0</span>,<span style="word-wrap:normal;word-break:normal;line-height:21px;margin:0px;padding:0px;color:#800080;">75.0</span>)];<br></pre></div>

<p>如果是用的Core Graphics框架来执行渲染的话，可以直接渲染Core Graphics的内容。用renderInContext:来做这个事。</p>
<div style="font-size:14px;color:#333333;line-height:26px;background-color:#ffffff;margin:5px 0px;padding:5px;font-family:&#39;courier new&#39;;border:1px solid #cccccc;overflow:auto;"><pre style="word-wrap:break-word;padding:0px;font-family:&#39;courier new&#39;;margin-top:0px;margin-bottom:0px;">[gameLayer renderInContext:UIGraphicsGetCurrentCont<wbr>ext()];</wbr></pre></div>

<p><span style="word-wrap:normal;word-break:normal;line-height:24px;margin:0px;padding:0px;font-size:16px;">8.变换：</span>要在一个层中添加一个3D或仿射变换，可以分别设置层的transform或affineTransform属性。</p>
<div style="font-size:14px;color:#333333;line-height:26px;background-color:#ffffff;margin:5px 0px;padding:5px;font-family:&#39;courier new&#39;;border:1px solid #cccccc;overflow:auto;"><pre style="word-wrap:break-word;padding:0px;font-family:&#39;courier new&#39;;margin-top:0px;margin-bottom:0px;">characterView.layer.transform = CATransform3DMakeScale(-<span style="word-wrap:normal;word-break:normal;line-height:21px;margin:0px;padding:0px;color:#800080;">1.0</span>,-<span style="word-wrap:normal;word-break:normal;line-height:21px;margin:0px;padding:0px;color:#800080;">1.0</span>,<span style="word-wrap:normal;word-break:normal;line-height:21px;margin:0px;padding:0px;color:#800080;">1.0</span>);<br><br>CGAffineTransform transform = CGAffineTransformMakeRot<wbr>ation(<span style="word-wrap:normal;word-break:normal;line-height:21px;margin:0px;padding:0px;color:#800080;">45.0</span>);<br>backgroundView.layer.affineTransform = transform;</wbr></pre></div>

<p><span style="word-wrap:normal;word-break:normal;line-height:24px;margin:0px;padding:0px;font-size:16px;">9.变形：</span>Quartz Core的渲染能力，使二维图像可以被自由操纵，就好像是三维的。图像可以在一个三维坐标系中以任意角度被旋转，缩放和倾斜。CATransform3D的一套方法提供了一些魔术般的变换效果。</p>
<p><span class="span4br"></span></p>
<p><span class="span4br"></span></p>
<p><span class="span4br"></span></p>
<p> <span class="span4br"></span></p>
<div style="font-size:14px;background-color:#f6f6f6;padding:0px;margin:0px;color:#555555;font-family:宋体, &#39;arial narrow&#39;, arial, serif;line-height:28px;text-align:-webkit-auto;"><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;">CALayer(层)是屏幕上的一个矩形区域，在每一个UIView中都包含一个根CALayer，在UIView上的所有视觉效果都是在这个Layer上进行的。</span></span></div><div style="font-size:14px;background-color:#f6f6f6;padding:0px;margin:0px;color:#555555;font-family:宋体, &#39;arial narrow&#39;, arial, serif;line-height:28px;text-align:-webkit-auto;"><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;">CALayer外形特征主要包括：<br>1、层的大小尺寸<br>2、背景色<br>3、内容（可以填充图片或者使用Core Graphics绘制的内容）<br>4、矩形是否使用圆角<br>5、矩形是否有阴影</span></span></div><div style="font-size:14px;background-color:#f6f6f6;padding:0px;margin:0px;color:#555555;font-family:宋体, &#39;arial narrow&#39;, arial, serif;line-height:28px;text-align:-webkit-auto;"><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;"><br></span></span></div><div style="font-size:14px;background-color:#f6f6f6;padding:0px;margin:0px;color:#555555;font-family:宋体, &#39;arial narrow&#39;, arial, serif;line-height:28px;text-align:-webkit-auto;"><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;">Layer有很多种，最常用也是最基本的是CALayer，当然还包括其他的子类：<br>CAScrollerLayer 简化显示层的一部分<br>CATextLayer 文本层<br>CAGradientLayer、CAShapeLayer等等</span></span></div><div style="font-size:14px;background-color:#f6f6f6;padding:0px;margin:0px;color:#555555;font-family:宋体, &#39;arial narrow&#39;, arial, serif;line-height:28px;text-align:-webkit-auto;"><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;"><br></span></span></div><div style="font-size:14px;background-color:#f6f6f6;padding:0px;margin:0px;color:#555555;font-family:宋体, &#39;arial narrow&#39;, arial, serif;line-height:28px;text-align:-webkit-auto;"><div style="padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;">使用层之前，需要在项目中引入QuartzCore.framework框架</span></span></div>

<p><a href="http://img1.51cto.com/attachment/201209/224142245.png" target="_blank"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;"><img src="http://img1.51cto.com/attachment/201209/224142245.png" alt="" title="CALayer与UIView的关系"></span></span></a></p>
<p><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;"><br></span></span><br></div><pre style="line-height:21px;padding:0px;background-color:#f7f7f7;font-family:&#39;courier new&#39;, monospace;font-size:12px;overflow:auto;width:712px;color:#555555;text-align:-webkit-auto;margin-top:0px;"></pre></p>
<ol>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:gray;background-color:inherit;">#import <wbr>&quot;LayerSampleViewControlle<wbr>r.h&quot;</wbr></wbr></span> <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;">@implementation <wbr>LayerSampleViewControlle<wbr>r <span class="span4br"></span></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:#008200;background-color:inherit;">// <wbr>Implement <wbr>loadView <wbr>to <wbr>create <wbr>a <wbr>view <wbr>hierarchy <wbr>programmatically, <wbr>without <wbr>using <wbr>a <wbr>nib.</wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></span> <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;">- <wbr>(<span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">void</span>)loadView <wbr>{ <span class="span4br"></span></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr>UIView <wbr>*rootView <wbr>= <wbr>[[UIView <wbr>alloc] <wbr>initWithFrame:CGRectMake(0, <wbr>0, <wbr>1024, <wbr>768)]; <span class="span4br"></span></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr>rootView.backgroundColor <wbr>= <wbr>[UIColor <wbr>whiteColor]; <span class="span4br"></span></wbr></wbr></wbr></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr>self.view <wbr>= <wbr>rootView; <span class="span4br"></span></wbr></wbr></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr>[rootView <wbr>release]; <span class="span4br"></span></wbr></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:#008200;background-color:inherit;">//加载layer</span> <span class="span4br"></span></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr>backLayer <wbr>= <wbr>[CALayer <wbr>layer]; <span class="span4br"></span></wbr></wbr></wbr></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr>backLayer.backgroundColor <wbr>= <wbr>[UIColor <wbr>orangeColor].CGColor; <span class="span4br"></span></wbr></wbr></wbr></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr>backLayer.bounds <wbr>= <wbr>CGRectMake(10, <wbr>10, <wbr>1004, <wbr>728); <wbr><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:#008200;background-color:inherit;">//设置layer的区域</span> <span class="span4br"></span></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr>backLayer.position <wbr>= <wbr>CGPointMake(1024/2, <wbr>768/2-10); <wbr><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:#008200;background-color:inherit;">//设置layer坐标</span> <span class="span4br"></span></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr>[self.view.layer <wbr>addSublayer:backLayer]; <span class="span4br"></span></wbr></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;">} <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:#008200;background-color:inherit;">// <wbr>Override <wbr>to <wbr>allow <wbr>orientations <wbr>other <wbr>than <wbr>the <wbr>default <wbr>portrait <wbr>orientation.</wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></span> <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;">- <wbr>(<span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:#2e8b57;background-color:inherit;font-weight:bold;">BOOL</span>)shouldAutorotateToInterf<wbr>aceOrientation:(UIInterfaceOrientation)interfaceOrientation <wbr>{ <span class="span4br"></span></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">return</span> <wbr>interfaceOrientation <wbr>== <wbr>UIInterfaceOrientationLa<wbr>ndscapeLeft; <span class="span4br"></span></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;">} <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;">- <wbr>(<span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">void</span>)didReceiveMemoryWarning <wbr>{ <span class="span4br"></span></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:#008200;background-color:inherit;">// <wbr>Releases <wbr>the <wbr>view <wbr>if <wbr>it <wbr>doesn&#39;t <wbr>have <wbr>a <wbr>superview.</wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></span> <span class="span4br"></span></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr>[super <wbr>didReceiveMemoryWarning]; <span class="span4br"></span></wbr></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:#008200;background-color:inherit;">// <wbr>Release <wbr>any <wbr>cached <wbr>data, <wbr>images, <wbr>etc <wbr>that <wbr>aren&#39;t <wbr>in <wbr>use.</wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></span> <span class="span4br"></span></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;">} <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;">- <wbr>(<span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">void</span>)viewDidUnload <wbr>{ <span class="span4br"></span></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:#008200;background-color:inherit;">// <wbr>Release <wbr>any <wbr>retained <wbr>subviews <wbr>of <wbr>the <wbr>main <wbr>view.</wbr></wbr></wbr></wbr></wbr></wbr></wbr></wbr></span> <span class="span4br"></span></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:#008200;background-color:inherit;">// <wbr>e.g. <wbr>self.myOutlet <wbr>= <wbr>nil;</wbr></wbr></wbr></wbr></span> <span class="span4br"></span></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;">} <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;">- <wbr>(<span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">void</span>)dealloc <wbr>{ <span class="span4br"></span></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <wbr> <wbr> <wbr> <wbr>[super <wbr>dealloc]; <span class="span4br"></span></wbr></wbr></wbr></wbr></wbr></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;">} <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;"> <span class="span4br"></span></span></span></p>
</li>
<li><p><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;border:none;color:black;background-color:inherit;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;border:none;background-color:inherit;font-family:&#39;comic sans ms&#39;;">@end <wbr></p>
<p></wbr></span></span><pre style="color:#494949;font-size:14px;line-height:21px;background-color:#f6f6f6;"><span class="span4br"></span> <span class="span4br"></span></pre><div style="font-size:14px;background-color:#f6f6f6;padding:0px;margin:0px;color:#555555;font-family:宋体, &#39;arial narrow&#39;, arial, serif;line-height:28px;text-align:-webkit-auto;"><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;"><br></span></span></div><div style="font-size:14px;background-color:#f6f6f6;padding:0px;margin:0px;color:#555555;font-family:宋体, &#39;arial narrow&#39;, arial, serif;line-height:28px;text-align:-webkit-auto;"><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;"><br></span></span></div><div style="font-size:14px;background-color:#f6f6f6;padding:0px;margin:0px;color:#555555;font-family:宋体, &#39;arial narrow&#39;, arial, serif;line-height:28px;text-align:-webkit-auto;"><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;">为了区分背景UIView，我将UIView的背景色设置为白色，backLayer的背景色设置为橘黄色。<br>上图是一个矩形区域，如果设置矩形的四个角是椭圆角，可以添加属性：<br>backLayer.cornerRadius = 20.0; //矩形椭圆角的弧度半径<br></span></span></div><div style="font-size:14px;background-color:#f6f6f6;padding:0px;margin:0px;color:#555555;font-family:宋体, &#39;arial narrow&#39;, arial, serif;line-height:28px;text-align:-webkit-auto;"><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;"><br></span></span></div><div style="font-size:14px;background-color:#f6f6f6;padding:0px;margin:0px;color:#555555;font-family:宋体, &#39;arial narrow&#39;, arial, serif;line-height:28px;text-align:-webkit-auto;"><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;"><br></span></span></div><div style="font-size:14px;background-color:#f6f6f6;padding:0px;margin:0px;color:#555555;font-family:宋体, &#39;arial narrow&#39;, arial, serif;line-height:28px;text-align:-webkit-auto;"><span style="word-wrap:normal;word-break:normal;line-height:21px;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;">添加带阴影的子Layer（层）,代码：<br>//添加子layer<br>CALayer *cyanLayer = [CALayer layer];<br>cyanLayer.backgroundColor = [UIColor cyanColor].CGColor;<br>cyanLayer.bounds = CGRectMake(0, 0, 300, 300);<br>cyanLayer.position = CGPointMake(180, 180);<br>cyanLayer.shadowOffset = CGSizeMake(0, 3); //设置阴影的偏移量<br>cyanLayer.shadowRadius = 10.0; //设置阴影的半径<br>cyanLayer.shadowColor = [UIColor blackColor].CGColor; //设置阴影的颜色为黑色<br>cyanLayer.shadowOpacity = 0.9; //设置阴影的不透明度</span></span></p>
</li>
</ol>
<p><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;">[backLayer addSublayer:cyanLayer];<br></span></span></p>
<p><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;"><br></span></span></p>
<p><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;">给子Layer添加图片</p>
<p>//添加子image layer<br>UIImage <em>image = [UIImage imageNamed:@&quot;feiche.jpg&quot;];<br>CALayer </em>imageLayer = [CALayer layer];<br>imageLayer.frame = CGRectMake(100, 100, image.size.width, image.size.height);<br>imageLayer.contents = (id) image.CGImage;<br>imageLayer.shadowOffset = CGSizeMake(0, 3); //设置阴影的偏移量<br>imageLayer.shadowRadius = 10.0; //设置阴影的半径<br>imageLayer.shadowColor = [UIColor blackColor].CGColor; //设置阴影的颜色为黑色<br>imageLayer.shadowOpacity = 0.9; //设置阴影的不透明度</span></span></p>
<p><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;">[backLayer addSublayer:imageLayer];<br></span></span></p>
<p><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;"><br></span></span></p>
<p><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;">图片加边框，代码：<br>imageLayer.borderColor = [UIColor grayColor].CGColor; //边框颜色<br>imageLayer.borderWidth = 2.0; //边框宽度</span></span></p>
<p><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;"><br>设置图片为椭圆角，代码：<br>imageLayer.cornerRadius = 10.0; //设置layer圆角半径<br>imageLayer.masksToBounds = YES; //隐藏边界<br></span></span></p>
<p><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;"><br></span></span></p>
<p><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;">但是由于设置masksToBounds 属性为true所以Layer的阴影效果也就没有了。<br>之前我都是将图片另外在做有阴影效果的图片，这样显的比较真实，如果阴影部分只是填充边框即可，可以采用两个Layer来实现阴影效果，代码：<br>UIImage <em>image = [UIImage imageNamed:@&quot;feiche.jpg&quot;];<br>//阴影layer<br>CALayer </em>shadowLayer = [CALayer layer];<br>shadowLayer.frame = CGRectMake(100, 100, image.size.width, image.size.height);<br>shadowLayer.backgroundColor = [UIColor blueColor].CGColor;<br>shadowLayer.shadowOffset = CGSizeMake(0, 3);<br>shadowLayer.cornerRadius = 10.0;<br>shadowLayer.shadowRadius = 10.0;<br>shadowLayer.shadowColor = [UIColor blackColor].CGColor; //设置阴影的颜色为黑色<br>shadowLayer.shadowOpacity = 1.0; //设置阴影的不透明度<br>[backLayer addSublayer:shadowLayer];</span></span></p>
<p><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;"><span style="word-wrap:normal;word-break:normal;padding:0px;margin:0px;font-family:&#39;comic sans ms&#39;;">//添加子image layer<br>CALayer *imageLayer = [CALayer layer];<br>imageLayer.frame = CGRectMake(100, 100, image.size.width, image.size.height);<br>imageLayer.contents = (id) image.CGImage;<br>imageLayer.cornerRadius = 10.0; //设置layer圆角半径<br>imageLayer.masksToBounds = YES; //隐藏边界<br>imageLayer.borderColor = [UIColor grayColor].CGColor; //边框颜色<br>imageLayer.borderWidth = 2.0;<br>[backLayer addSublayer:imageLayer];</span></span><br></div></p>
<p><span class="span4br"></span></p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/u/2049029440"><strong>牙-_签</strong></a> - 3月 25 2013</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://toothpick2012.github.io/"><strong>Toothpick&#39;s blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/2013/01/10/苹果-开发者账号区别（转）/">苹果 开发者账号区别（转）</a></h1>
  

      <time datetime="2013-01-09T22:26:00.000Z"><a href="/2013/01/10/苹果-开发者账号区别（转）/">1月 10 2013</a></time>
      
  </header>
    <div class="entry">
      
        <p><span class="span4br"></span></p>
<p>苹果 开发者账号如下：</p>
<p>99美金个人用户</p>
<p>99美金团队：</p>
<p><span class="span4br"></span></p>
<p>审核多了企业资质认证,可以多开发者共享.（如何共享？）这个测试的时候如果有多个人的话，可以拆分多个子账户出来测试，对于测试方便点。也就是说一个AppleID对应于多个Devices ID。<br><span class="span4br"></span></p>
<p>299美金企业用户：面向拥有500雇员以上的公司,开发专用的企业内部使用的app。这个账号需要邓氏码，小企业一般申请不下来，但只要有那个码就好办了（500或者500以上的公司用于内部分发）。为企业客户发布应用,例如为某集团发布办公客户端</p>
<p>区别：</p>
<p>个人和公司的区别：个人的账号只能显示个人的Full Name，公司则可以显示类似Studios，或者自定义的团队名称 。<br><span class="span4br"></span></p>
<p>公司帐号比个人多一些帐号管理的设置：个人帐号集Agent，Admin，Developer等为一身，而公司帐号可以设置不同的AppleID来担当。<br><span class="span4br"></span></p>
<p> 99美元的是供个人开发使用，</p>
<p>99的为公司使用，可以自己定义一定数量的开发者子账号，不过只能有主账号来提交，发布等操作。</p>
<p>299的是供企业内部账号使用，外面用户不能使用itunes访问到。而且绑定认证次数无限 &nbsp;</p>
<p><span class="span4br"></span></p>
<p>注意一点，公司和个人帐号都是99$一年；而299$那个是大企业专用，无法提交App到App Store，只能公司内部自用，比如基于iOS的OA系统</p>
<p><span class="span4br"></span></p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/u/2049029440"><strong>牙-_签</strong></a> - 1月 10 2013</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://toothpick2012.github.io/"><strong>Toothpick&#39;s blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/2013/01/09/xcode-4透過ad-hoc發佈app給其它裝置測試使用/">Xcode 4透過Ad-Hoc發佈App給其它裝置測試使用 </a></h1>
  

      <time datetime="2013-01-09T01:45:56.000Z"><a href="/2013/01/09/xcode-4透過ad-hoc發佈app給其它裝置測試使用/">1月 9 2013</a></time>
      
  </header>
    <div class="entry">
      
        <div class="alumb" style="color:#333333;font-family:arial;line-height:26px;margin:10px 0px;padding:4px;border:1px solid #cccccc;outline:0px;font-size:15px;vertical-align:baseline;text-align:center;clear:both;">这次迭代版本出了一个非常蛋疼的问题，调试版本不会出现bug，线上版本在ios6上出现一定概率闪退。这问题就蛋疼了，线上版本又不能直接测试，所以就想到了Ad Hoc的方式模拟上线版本来测出问题。目前问题以接近解决，还需要更多的测试。这行bug出的不讲理，只能尽可能的避免啦。</div><div class="alumb" style="color:#333333;font-family:arial;line-height:26px;margin:10px 0px;padding:4px;border:1px solid #cccccc;outline:0px;font-size:15px;vertical-align:baseline;text-align:center;clear:both;">编程能力还需不断的精进，谢谢高手分享这篇文章</div><div class="alumb" style="color:#333333;font-family:arial;line-height:26px;margin:10px 0px;padding:4px;border:1px solid #cccccc;outline:0px;font-size:15px;vertical-align:baseline;text-align:center;clear:both;"><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_00.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"></div><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">　　先前曾分享過，透過憑證的設定，將Xcode開發好的App，同步到開發者行動裝置中，來進行除錯與測試，但由於一般的開發者，很難手邊同時有iPhone 3Gs、iPod Touch、iPhone 4、4s…等，這時就得靠平常的生活外交了，但總不可能把朋友手機一一的借來測試，所以這時候最好的辦法，就是將寫好的App發佈出來，安裝到各式不同的裝置上來進行測試，看是否都能正常的運作，這時就得透過Ad-Hoc的方式，將App發佈出來並安裝，而安裝方式有二種，一種是透過iTunes，另一種則是透過線上的方式來進行安裝，而這也讓梅干搞了半天，好在有好友Jason的相助，終於順利的讓App發佈出來啦！現在趁著梅干還記憶猶新時，把整個的過程記錄與分享。</span><br><br><em> </em> <em><br><span style="font-family:arial;line-height:26px;font-size:24px;color:#0033ff;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;font-size:21px;vertical-align:baseline;">Ad-Hoc(iTunes安裝):</span></span><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step1</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">進入</span><a href="https://developer.apple.com/devcenter/ios/index.action" target="_blank">iOS Dev Center</a><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">，進入後點選</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">Certificate</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"> / </span><span style="font-family:arial;line-height:26px;color:#ff0033;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Distribution</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">，點</span><span style="font-family:arial;line-height:26px;color:#0033ff;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Request Certificate</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">鈕。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_01.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span>

</em> <em> </em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step2</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">接著拉到下方，按選擇檔案，將之前所產生的Key載入，再按</span><span style="font-family:arial;line-height:26px;color:#0033ff;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Sumbit</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">鈕。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_02.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span><br><br><em> </em> <em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step3</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">過一回後，再按</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">Download</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">鈕，並雙響下載的</span><span style="font-family:arial;line-height:26px;color:#ff0000;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">.cer</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">檔。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_03.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span>

</em> <em> </em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step4</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">接著就會將憑證匯入MAC的鑰匙圈中。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_04.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span><br><br><em> </em> <em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step5</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">回到iOS Dev Center，切到</span><span style="font-family:arial;line-height:26px;color:#ff0033;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Devices</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">，將要測試手機的</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">UIID</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">匯入。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_05.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span>

</em> <em> </em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step6</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">再切到</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">Provisioning</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"> / </span><span style="font-family:arial;line-height:26px;color:#ff0033;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Distribution</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"> ，點右上的</span><span style="font-family:arial;line-height:26px;color:#0033ff;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">New Profile</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_06.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span><br><br><em> </em> <em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step7</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">選擇</span><span style="font-family:arial;line-height:26px;color:#ff0033;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Ad Hoc</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">，再將要測試的裝置，給勾選起來。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_06_1.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span>

</em> <em> </em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step8</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">過一回，再按</span><span style="font-family:arial;line-height:26px;color:#0033ff;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Download</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">鈕。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_07.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span><br><br><em> </em> <em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step9</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">下載完畢後，雙響它。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_08.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span>

</em> <em> </em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step10</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">接著就會匯入Xcode中。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_09.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span><br><br><em> </em> <em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step11</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">回到</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">Xcode</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"> , 對著專案名稱，按滑鼠右鍵，選擇</span><span style="font-family:arial;line-height:26px;color:#0033ff;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">New File</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_10.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span>

</em> <em> </em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step12</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">選擇</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">Code Signing</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"> -&gt; </span><span style="font-family:arial;line-height:26px;color:#0033ff;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Entitlements</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_11.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span><br><br><em> </em> <em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step13</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">名稱不用作任何更改，再按</span><span style="font-family:arial;line-height:26px;color:#0033ff;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Save</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">鈕。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_12.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span>

</em> <em> </em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step14</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">點一下剛所建立的</span><span style="font-family:arial;line-height:26px;color:#0033ff;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Entitlements.plist</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">檔案，將Value設成</span><span style="font-family:arial;line-height:26px;color:#ff0033;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">NO</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_13.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span><br><br><em> </em> <em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step15</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">接著點下專案，切到</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">Info</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">頁籤下，在</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">Configurations</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">按加號，複製release並命名成</span><span style="font-family:arial;line-height:26px;color:#0033ff;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">AdHoc</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_14.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span>

</em> <em> </em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step16</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">再切到</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">Build Settings</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">頁籤，將</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">code Signing Entitlements</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">，設成剛所新增的</span><span style="font-family:arial;line-height:26px;color:#ff0000;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Entitlements.plist</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">，再把</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">Code Signing Identity</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">下的</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">AdHoc</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">設成</span><span style="font-family:arial;line-height:26px;color:#ff0000;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">iPhone Distribution</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_15.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span><br><br><em> </em> <em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step17</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">都完成後，就按上方的</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">Run</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">，完成後在</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">Product</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">下就會看到產生好的</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">.app</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">檔，對著它按滑鼠右鍵，選擇</span><span style="font-family:arial;line-height:26px;color:#0033ff;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Show in Finder</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_16.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span>

</em> <em> </em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step18</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">對著.app按滑鼠右鍵，選擇壓縮xxx.app。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_17.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span><br><br><em> </em> <em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step19</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">都完成後，將剛所產生的壓縮檔，與在Step8所產生的檔案，一起拉到iTunes中，就可完成安裝，但這樣實在有些不便，所以接下來直接介紹線上安裝的方式。</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_18.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span>

</em> <em> </em><br><span style="font-family:arial;line-height:26px;font-size:24px;color:#0033ff;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;font-size:21px;vertical-align:baseline;">Ad-Hoc(線上安裝):</span></span><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step20</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">回到Xcode，點一下Sotp旁的下拉選單，選擇</span><span style="font-family:arial;line-height:26px;color:#ff0033;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Edit Scheme..</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">。 </span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_19.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span><br><br><em> </em> <em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step21</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">切到</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">Archive</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">，將</span><span style="font-family:arial;line-height:26px;color:#0033ff;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Build Configuration</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">設成</span><span style="font-family:arial;line-height:26px;color:#ff0000;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Adhoc</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">。 </span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_20.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span>

</em> <em> </em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step22</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">完成後，再選擇功能 </span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">Product</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"> / </span><span style="font-family:arial;line-height:26px;color:#ff0000;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Archive</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">。 </span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_21.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span><br><br><em> </em> <em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step23</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">發佈好後，就會切到</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">Organizer-Archives</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">面板，點右上</span><span style="font-family:arial;line-height:26px;color:#0033ff;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Share</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">鈕。 </span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_23.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span>

</em> <em> </em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step24</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">在</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">Identity</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">選擇</span><span style="font-family:arial;line-height:26px;color:#ff0000;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">iPhone Distribution..</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">。 </span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_24.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span><br><br><em> </em> <em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step25</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">記得把</span><span style="font-family:arial;line-height:26px;color:#ff0033;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Save for Enterprise Distribution</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">選擇勾起來，在</span><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;">URL</span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">的地方，就是ipa在網路空間的位置，因此得照實輸入，否則待回會無法安裝喔! </span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_25.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span>

</em> <em> </em><br><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step26</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">接著直接複製下方的語法，修改紅色的地方，那路徑與剛在Xcode建立的相同才行喔!都弄好了，分別將xxx.html、xxx.ipa、xxx.plist上傳到網路空間中。 </span><br><span class="codetitle" style="font-family:arial;line-height:26px;color:#7799aa;margin:0px;padding:0px 0px 0px 25px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;font-weight:bold;clear:both;">安裝網頁-原始碼(setup.html):</span><br><div class="code" style="font-family:arial;letter-spacing:0px;margin:0px 0px 0px 7px;padding:10px 10px 10px 21px;border:1px solid #cccccc;outline:0px;font-size:12px;vertical-align:baseline;word-break:break-all;color:#232323;overflow:auto;width:550px;line-height:1.333em;">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;<a href="http://www.w3.org/TR/html4/loose.dtd&quot;&amp;gt" target="_blank">http://www.w3.org/TR/html4/loose.dtd&quot;&amp;gt</a>; <span class="span4br"></span>&lt;html&gt;<span class="span4br"></span>&lt;head&gt; <span class="span4br"></span>&lt;title&gt;Setup My App&lt;/title&gt; <span class="span4br"></span>&lt;/head&gt; <span class="span4br"></span>&lt;body&gt;<span class="span4br"></span>&lt;ul&gt;<span class="span4br"></span>&lt;li&gt;&lt;a href=&quot;itms-services://?action=download-manifest&amp;url=<span style="color:#ff0000;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><a href="http://xxx.xxx.com/xxx.plist" target="_blank">http://xxx.xxx.com/xxx.plist</a></span>&quot;&gt; Tap Here to Install the Application&lt;/a&gt;<span class="span4br"></span>&lt;/li&gt; <span class="span4br"></span>&lt;/ul&gt; <span class="span4br"></span>&lt;/body&gt; <span class="span4br"></span>&lt;/html&gt;</div>

<hr>
<p><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step25</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">接著把網址給要測試的朋友， 只要點一下連結，再按</span><span style="font-family:arial;line-height:26px;color:#0033ff;margin:0px;padding:0px;border-width:0px;outline:0px;font-size:15px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">「安裝」</span></span><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">。 </span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_26.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span></p>
<hr>
<p><span style="color:#333333;font-family:arial;line-height:26px;margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;"><span style="margin:0px;padding:0px;border-width:0px;outline:0px;vertical-align:baseline;">Step26</span></span><br><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">這時就會開始安裝，安裝完後就可開始，測試與使用囉!</span><br><img src="http://img.minwt.com/img/Content/iphone/xcode_adhoc/xcode_adhoc_27.jpg" alt="梅問題-iPhone開發教學－Xcode透過Ad-Hoc發佈App給其它裝置測試使用"><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;"></span></p>
<hr>
<p><span style="color:#333333;font-family:arial;font-size:14px;line-height:26px;background-color:#ffffff;">　　呼！相信各位看到這邊，應該心都涼了一半，付費會員比沒付費員還要來的麻煩，但看起來很繁索，但實際的多做幾次後，就會發現其實沒想像中來的難，而畫面來初換初換去的，因此各位在操作要仔細看，若有漏掉某一部分，就會造成無法安裝成功的冏境喔！</span></p>
<p><span class="span4br"></span></p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/u/2049029440"><strong>牙-_签</strong></a> - 1月 9 2013</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://toothpick2012.github.io/"><strong>Toothpick&#39;s blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/2012/12/28/上传-appstore-出现an-error-occurred-uploading-to-the-itunes-store问题解决/">上传 appstore 出现&quot;an error occurred uploading to the itunes store&quot;问题解决</a></h1>
  

      <time datetime="2012-12-28T01:22:11.000Z"><a href="/2012/12/28/上传-appstore-出现an-error-occurred-uploading-to-the-itunes-store问题解决/">12月 28 2012</a></time>
      
  </header>
    <div class="entry">
      
        <p>度娘、谷哥说这个是java版本太新啦！</p>
<p>之前我更新了JDK1.7，好像这个问题遇到过。最直接的是去实用工具——java偏好设置——选择1.6JDK，但是这次更新Lion10.7.5后，这个设置不见了。</p>
<p>查到终端切换方法</p>
<p><span class="span4br"></span></p>
<p>cd /System/Library/Frameworks/JavaVM.framework/Versions</p>
<p>sudo ln -s CurrentJDK /System/Library/Frameworks/JavaVM.framework/Versions/1.5</p>
<p>sudo ln -s CurrentJDK /System/Library/Frameworks/JavaVM.framework/Versions/1.5.0</p>
<p><span class="span4br"></span></p>
<p>可惜出现</p>
<p>ln: /System/Library/Frameworks/JavaVM.framework/Versions/1.5/CurrentJDK: File exists<span style="color:#666666;font-family:verdana, geneva, sans-serif;font-size:14px;line-height:19px;background-color:#ffffff;"></span><span class="span4br"></span></p>
<p><span class="span4br"></span></p>
<p>再查发现，需要先移除当前的JDK版本</p>
<p><span style="color:#666666;font-family:monospace;font-size:14px;line-height:19px;background-color:#ffffff;"></span></p>
<p>sudo mv Current Current1.7</p>
<p>sudo ln -s /System/Library/Frameworks/JavaVM.framework/Versions/1.6.0 Current</p>
<p><span style="color:#666666;font-family:monospace;font-size:14px;line-height:19px;background-color:#ffffff;"></span><span class="span4br"></span></p>
<p><span class="span4br"></span></p>
<p>然后打&#39;java -version&#39;，查看版本</p>
<p>java version &quot;1.6.0_37&quot;<span class="span4br"></span></p>
<p><span class="span4br"></span></p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/u/2049029440"><strong>牙-_签</strong></a> - 12月 28 2012</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://toothpick2012.github.io/"><strong>Toothpick&#39;s blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/2012/12/26/ios应用生命周期/">ios应用生命周期</a></h1>
  

      <time datetime="2012-12-25T22:22:57.000Z"><a href="/2012/12/26/ios应用生命周期/">12月 26 2012</a></time>
      
  </header>
    <div class="entry">
      
        <h3 id="_"> </h3>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span class="span4br"></span></p>
<h3 id="_-1"> </h3>
<p>&nbsp;&nbsp;&nbsp;&nbsp;一、挂起</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;当有电话进来或者锁屏，这时你的应用程会挂起，在这时，UIApplicationDelegate委托会收到通知，调用&nbsp;applicationWillResignActive&nbsp;方法，你可以重写这个方法，做挂起前的工作，比如关闭网络，保存数据。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;当你的程序被挂起后他不会在后台运行。</p>
<p><span class="span4br"></span></p>
<h3 id="_-1"> </h3>
<p>&nbsp;&nbsp;&nbsp;&nbsp;二、复原</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;当程序复原时，另一个名为&nbsp;applicationDidBecomeActive&nbsp;委托方法会被调用，在此你可以通过之前挂起前保存的数据来恢复你的应用程序</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span class="span4br"></span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;注意：应用程序在启动时，在调用了&nbsp;applicationDidFinishLaunching&nbsp;方法之后也会调用&nbsp;applicationDidBecomeActive&nbsp;方法，所以你要确保你的代码能够分清复原与启动，避免出现逻辑上的bug。</p>
<p><span class="span4br"></span></p>
<h3 id="_-1"> </h3>
<p>&nbsp;&nbsp;&nbsp;&nbsp;三、终止</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;当用户按下按钮，或者关机，程序都会被终止。当一个程序将要正常终止时会调用&nbsp;applicationWillTerminate方法。但是如果长主按钮强制退出，则不会调用该方法。这个方法该执行剩下的清理工作，比如所有的连接都能正常关闭，并在程序退出前执行任何其他的必要的工作：</p>
<pre lang="objective-c">
- (void)applicationWillTerminate:(UIApplication*)application{    

}    

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions  
{  
    // Override point for customization after application launch.  
    NSLog(@"\n ===> 程序开始 !");   

    return YES;  
}  

- (void)applicationWillResignActive:(UIApplication *)application  
{  

    NSLog(@"\n ===> 程序暂行 !");   
}  

- (void)applicationDidEnterBackground:(UIApplication *)application  
{  

     NSLog(@"\n ===> 程序进入后台 !");   
}  

- (void)applicationWillEnterForeground:(UIApplication *)application  
{  

     NSLog(@"\n ===> 程序进入前台 !");   
}  

- (void)applicationDidBecomeActive:(UIApplication *)application  
{  
    NSLog(@"\n ===> 程序重新激活 !");   

}  

- (void)applicationWillTerminate:(UIApplication *)application  
{  
    NSLog(@"\n ===> 程序意外暂行 !");   

    UIDevice *device = [UIDevice currentDevice];  

}  
</pre>

<p>&nbsp;&nbsp;&nbsp;&nbsp;<span class="span4br"></span></p>
<h3 id="_-1"> </h3>
<p>&nbsp;&nbsp;&nbsp;&nbsp;首次运行：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;(BOOL)application:(UIApplication&nbsp;<em>)application&nbsp;didFinishLaunchingWithOptions:(NSDictionary&nbsp;</em>)launchOptions</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;(void)applicationDidBecomeActive:(UIApplication&nbsp;*)application</p>
<p><span class="span4br"></span></p>
<h3 id="_-1"> </h3>
<p>&nbsp;&nbsp;&nbsp;&nbsp;首次关闭（home）：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;(void)applicationWillResignActive:(UIApplication&nbsp;*)application</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;(void)applicationDidEnterBackground:(UIApplication&nbsp;*)application</p>
<p><span class="span4br"></span></p>
<h3 id="_-1"> </h3>
<p>&nbsp;&nbsp;&nbsp;&nbsp;再次运行：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;(void)applicationWillEnterForeground:(UIApplication&nbsp;*)application</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;(void)applicationDidBecomeActive:(UIApplication&nbsp;*)application</p>
<p><span class="span4br"></span></p>
<h3 id="_-1"> </h3>
<p>&nbsp;&nbsp;&nbsp;&nbsp;再次关闭：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;(void)applicationWillResignActive:(UIApplication&nbsp;*)application</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;(void)applicationDidEnterBackground:(UIApplication&nbsp;*)application</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span class="span4br"></span></p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/u/2049029440"><strong>牙-_签</strong></a> - 12月 26 2012</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://toothpick2012.github.io/"><strong>Toothpick&#39;s blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/2012/12/19/ios-object-c开发中混合使用或不使用arc/">ios objective-c开发中混合使用或不使用ARC</a></h1>
  

      <time datetime="2012-12-19T00:55:25.000Z"><a href="/2012/12/19/ios-object-c开发中混合使用或不使用arc/">12月 19 2012</a></time>
      
  </header>
    <div class="entry">
      
        <p><embed height="0" id="xunlei_com_thunder_helper_plugin_d462f475-c18e-46be-bd10-327458d045bd" type="application/thunder_download_plugin" width="0" /><span style="color:#362e2b;font-family:arial;font-size:14px;line-height:26px;text-align:left;">xcode不断进步，在xcode4中引入了ARC的概念。您用或者不用它就在那里，于是有了本文:如何在未使用arc的工程中引入一个使用了arc特性的文件，如何在arc工程中引用未使用arc的文件。其实说白了也很简单就是在”Compile Sources”中对相应的文件加入使用或者不使用arc的flag</span></p>
<p><embed height="0" id="xunlei_com_thunder_helper_plugin_d462f475-c18e-46be-bd10-327458d045bd" type="application/thunder_download_plugin" width="0" /><span style="color:#362e2b;font-family:arial;font-size:14px;line-height:26px;text-align:left;">ok,首选“Compile Sources”的位置:选中工程-&gt;TARGETS-&gt;相应的target然后选中右侧的“Build Phases”，向下就找到“Compile Sources”了。</span></p>
<p>如何在未使用arc的工程中引入一个使用了arc特性的文件:对相应的文件添加:-fobjc-arc参数</p>
<p>如何在arc工程中引用未使用arc的文件:对相应的文件添加:-fnoobjc-arc参数</p>
<p><span class="span4br"></span></p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/u/2049029440"><strong>牙-_签</strong></a> - 12月 19 2012</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://toothpick2012.github.io/"><strong>Toothpick&#39;s blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/2012/12/16/coretext进行文字排版/">CoreText进行文字排版</a></h1>
  

      <time datetime="2012-12-15T23:10:51.000Z"><a href="/2012/12/16/coretext进行文字排版/">12月 16 2012</a></time>
      
  </header>
    <div class="entry">
      
        <p><span style="font-size:18px;">coretext实现UIlable的字间距和行间距的设置</span></p>
<pre lang="objective-c">#import<foundation>#import<uikit>@interface TextLabel : UILabel{ &nbsp; &nbsp;@private &nbsp; &nbsp; &nbsp; &nbsp;CGFloat characterSpacing_; &nbsp; &nbsp; &nbsp; //字间距 &nbsp; &nbsp;@private &nbsp; &nbsp; &nbsp; &nbsp;long linesSpacing_; &nbsp; //行间距 &nbsp; &nbsp;}@property(nonatomic,assign) CGFloat characterSpacing;@property(nonatomic,assign) long linesSpacing;//准确计算CoreText高度的方法- (int)getAttributedStringHeightWithString:(NSAttributedString *) &nbsp;string &nbsp;WidthValue:(int) width;@end</uikit></foundation></pre>

<p>[html lang=&quot;objective-c&quot;]#import &quot;TextLabel.h&quot;#import<br><coretext>@implementation TextLabel@synthesize characterSpacing = characterSpacing<em>;@synthesize linesSpacing = linesSpacing</em>;-(id) initWithFrame:(CGRect)frame{//初始化字间距、行间距 &nbsp; &nbsp; &nbsp; &nbsp;if(self =[superinitWithFrame:frame]) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self.characterSpacing = 2.0f; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self.linesSpacing = 5.0f; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;returnself; &nbsp; &nbsp;}-(void)setCharacterSpacing:(CGFloat)characterSpacing //外部调用设置字间距{ &nbsp; &nbsp; &nbsp; &nbsp;characterSpacing<em> = characterSpacing; &nbsp; &nbsp; &nbsp; &nbsp;[selfsetNeedsDisplay]; &nbsp; &nbsp;}-(void)setLinesSpacing:(long)linesSpacing &nbsp;//外部调用设置行间距{ &nbsp; &nbsp; &nbsp; &nbsp;linesSpacing</em> = linesSpacing; &nbsp; &nbsp; &nbsp; &nbsp;[selfsetNeedsDisplay]; &nbsp; &nbsp;}-(void) drawTextInRect:(CGRect)requestedRect{ &nbsp; &nbsp; &nbsp; &nbsp;//去掉空行 &nbsp; &nbsp;// &nbsp; &nbsp;NSString <em>labelString = self.text;// &nbsp; &nbsp;// &nbsp; &nbsp;NSString </em>myString = [labelString stringByReplacingOccurrencesOfString:@&quot;\r\n&quot; withString:&quot;\n&quot;]; &nbsp; &nbsp; &nbsp; &nbsp;//创建AttributeString &nbsp; &nbsp; &nbsp; &nbsp;NSMutableAttributedString <em>string =[[NSMutableAttributedStringalloc]initWithString:self.text]; &nbsp; &nbsp; &nbsp; &nbsp;string = [selfsetStyle:string]; &nbsp; &nbsp; &nbsp; &nbsp;//排版 &nbsp; &nbsp; &nbsp; &nbsp;CTFramesetterRef framesetter = CTFramesetterCreateWithAttributedString((CFAttributedStringRef)string); &nbsp; &nbsp; &nbsp; &nbsp;CGMutablePathRef leftColumnPath = CGPathCreateMutable(); &nbsp; &nbsp; &nbsp; &nbsp;CGPathAddRect(leftColumnPath, NULL ,CGRectMake(0 , 0 ,self.bounds.size.width , self.bounds.size.height)); &nbsp; &nbsp; &nbsp; &nbsp;CTFrameRef leftFrame = CTFramesetterCreateFrame(framesetter,CFRangeMake(0, 0), leftColumnPath , NULL); &nbsp; &nbsp; &nbsp; &nbsp;//翻转坐标系统（文本原来是倒的要翻转下） &nbsp; &nbsp; &nbsp; &nbsp;CGContextRef context = UIGraphicsGetCurrentContext(); &nbsp; &nbsp; &nbsp; &nbsp;CGContextSetTextMatrix(context , CGAffineTransformIdentity); &nbsp; &nbsp; &nbsp; &nbsp;CGContextTranslateCTM(context , 0 ,self.bounds.size.height); &nbsp; &nbsp; &nbsp; &nbsp;CGContextScaleCTM(context, 1.0 ,-1.0); &nbsp; &nbsp; &nbsp; &nbsp;//画出文本 &nbsp; &nbsp; &nbsp; &nbsp;CTFrameDraw(leftFrame,context); &nbsp; &nbsp; &nbsp; &nbsp;//释放 &nbsp; &nbsp; &nbsp; &nbsp;CGPathRelease(leftColumnPath); &nbsp; &nbsp; &nbsp; &nbsp;CFRelease(framesetter); &nbsp; &nbsp; &nbsp; &nbsp;CFRelease(leftFrame); &nbsp; &nbsp; &nbsp; &nbsp;[string release]; &nbsp; &nbsp; &nbsp; &nbsp;UIGraphicsPushContext(context); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}-(NSMutableAttributedString</em>)setStyle:(NSMutableAttributedString<em>)string{ &nbsp; &nbsp;//设置字体及大小 &nbsp; &nbsp; &nbsp; &nbsp;CTFontRef helveticaBold = CTFontCreateWithName((CFStringRef)self.font.fontName,self.font.pointSize,NULL); &nbsp; &nbsp; &nbsp; &nbsp;[string addAttribute:(id)kCTFontAttributeNamevalue:(id)helveticaBold range:NSMakeRange(0,[string length])]; &nbsp; &nbsp; &nbsp; &nbsp;CFRelease(helveticaBold); &nbsp; &nbsp;//设置字间距 &nbsp; &nbsp; &nbsp; &nbsp;if(self.characterSpacing) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;long number = self.characterSpacing; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CFNumberRef num = CFNumberCreate(kCFAllocatorDefault,kCFNumberSInt8Type,&amp;number); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[string addAttribute:(id)kCTKernAttributeNamevalue:(id)num range:NSMakeRange(0,[string length])]; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CFRelease(num); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;//设置字体颜色 &nbsp; &nbsp; &nbsp; &nbsp;[string addAttribute:(id)kCTForegroundColorAttributeNamevalue:(id)(self.textColor.CGColor) range:NSMakeRange(0,[string length])]; &nbsp; &nbsp; &nbsp; &nbsp;//创建文本对齐方式 &nbsp; &nbsp; &nbsp; &nbsp;CTTextAlignment alignment = kCTLeftTextAlignment; &nbsp; &nbsp; &nbsp; &nbsp;if(self.textAlignment == UITextAlignmentCenter) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alignment = kCTCenterTextAlignment; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;if(self.textAlignment == UITextAlignmentRight) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alignment = kCTRightTextAlignment; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp;CTParagraphStyleSetting alignmentStyle; &nbsp; &nbsp; &nbsp; &nbsp;alignmentStyle.spec = kCTParagraphStyleSpecifierAlignment; &nbsp; &nbsp; &nbsp; &nbsp;alignmentStyle.valueSize = sizeof(alignment); &nbsp; &nbsp; &nbsp; &nbsp;alignmentStyle.value = &amp;alignment; &nbsp; &nbsp; &nbsp; &nbsp;//设置文本行间距 &nbsp; &nbsp; &nbsp; &nbsp;CGFloat lineSpace = self.linesSpacing; &nbsp; &nbsp; &nbsp; &nbsp;CTParagraphStyleSetting lineSpaceStyle; &nbsp; &nbsp; &nbsp; &nbsp;lineSpaceStyle.spec = kCTParagraphStyleSpecifierLineSpacingAdjustment; &nbsp; &nbsp; &nbsp; &nbsp;lineSpaceStyle.valueSize = sizeof(lineSpace); &nbsp; &nbsp; &nbsp; &nbsp;lineSpaceStyle.value =&amp;lineSpace; &nbsp; &nbsp; &nbsp; &nbsp;//设置文本段间距 &nbsp; &nbsp; &nbsp; &nbsp;CGFloat paragraphSpacing = 5.0; &nbsp; &nbsp; &nbsp; &nbsp;CTParagraphStyleSetting paragraphSpaceStyle; &nbsp; &nbsp; &nbsp; &nbsp;paragraphSpaceStyle.spec = kCTParagraphStyleSpecifierParagraphSpacing; &nbsp; &nbsp; &nbsp; &nbsp;paragraphSpaceStyle.valueSize = sizeof(CGFloat); &nbsp; &nbsp; &nbsp; &nbsp;paragraphSpaceStyle.value = ¶graphSpacing; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//创建设置数组 &nbsp; &nbsp; &nbsp; &nbsp;CTParagraphStyleSetting settings[ ] ={alignmentStyle,lineSpaceStyle,paragraphSpaceStyle}; &nbsp; &nbsp; &nbsp; &nbsp;CTParagraphStyleRef style = CTParagraphStyleCreate(settings , sizeof(settings)); &nbsp; &nbsp; &nbsp; &nbsp;CFRelease(settings); &nbsp; &nbsp;//给文本添加设置 &nbsp; &nbsp; &nbsp; &nbsp;[string addAttribute:(id)kCTParagraphStyleAttributeName value:(id)style range:NSMakeRange(0 , [string length])]; &nbsp; &nbsp; &nbsp; &nbsp;CFRelease(style); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return string;}//准确计算CoreText高度的方法- (int)getAttributedStringHeightWithString:(NSMutableAttributedString </em>) &nbsp;string &nbsp;WidthValue:(int) width{ &nbsp; &nbsp;string = [selfsetStyle:string]; &nbsp; &nbsp; &nbsp; &nbsp;int total_height = 0; &nbsp; &nbsp; &nbsp; &nbsp;CTFramesetterRef framesetter = CTFramesetterCreateWithAttributedString((CFAttributedStringRef)string); &nbsp; &nbsp;//string 为要计算高度的NSAttributedString &nbsp; &nbsp;CGRect drawingRect = CGRectMake(0, 0, width, 99999); &nbsp;//这里的高要设置足够大 &nbsp; &nbsp;CGMutablePathRef path = CGPathCreateMutable(); &nbsp; &nbsp;CGPathAddRect(path, NULL, drawingRect); &nbsp; &nbsp;CTFrameRef textFrame = CTFramesetterCreateFrame(framesetter,CFRangeMake(0,0), path, NULL); &nbsp; &nbsp;CGPathRelease(path); &nbsp; &nbsp;CFRelease(framesetter); &nbsp; &nbsp; &nbsp; &nbsp;NSArray <em>linesArray = (NSArray </em>) CTFrameGetLines(textFrame); &nbsp; &nbsp; &nbsp; &nbsp;CGPoint origins[[linesArray count]]; &nbsp; &nbsp;CTFrameGetLineOrigins(textFrame, CFRangeMake(0, 0), origins); &nbsp; &nbsp; &nbsp; &nbsp;int line_y = (int) origins[[linesArray count] -1].y; &nbsp;//最后一行line的原点y坐标 &nbsp; &nbsp; &nbsp; &nbsp;CGFloat ascent; &nbsp; &nbsp;CGFloat descent; &nbsp; &nbsp;CGFloat leading; &nbsp; &nbsp; &nbsp; &nbsp;CTLineRef line = (CTLineRef) [linesArray objectAtIndex:[linesArray count]-1]; &nbsp; &nbsp;CTLineGetTypographicBounds(line, &amp;ascent, &amp;descent, &amp;leading); &nbsp; &nbsp; &nbsp; &nbsp;total_height = 99999 - line_y + (int) descent +1; &nbsp; &nbsp;//+1为了纠正descent转换成int小数点后舍去的值 &nbsp; &nbsp; &nbsp; &nbsp;CFRelease(textFrame); &nbsp; &nbsp; &nbsp; &nbsp;return total_height; &nbsp; &nbsp;}@end[/html]</coretext></p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/u/2049029440"><strong>牙-_签</strong></a> - 12月 16 2012</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://toothpick2012.github.io/"><strong>Toothpick&#39;s blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/2012/12/10/sdwebimage-笔记（转）/">SDWebImage 笔记（转）</a></h1>
  

      <time datetime="2012-12-09T18:39:19.000Z"><a href="/2012/12/10/sdwebimage-笔记（转）/">12月 10 2012</a></time>
      
  </header>
    <div class="entry">
      
        <p>SDWebImage托管在github上。<a href="https://github.com/rs/SDWebImage" target="_blank">https://github.com/rs/SDWebImage</a><br>这个类库提供一个UIImageView类别以支持加载来自网络的远程图片。具有缓存管理、异步下载、同一个URL下载次数控制和优化等特征。<br>使用示范的代码：<br>UITableView使用UIImageView+WebCache类（基本应用，UIImageView的一个category）<br>前提#import导入UIImageView+WebCache.h文件，然后在tableview的cellForRowAtIndexPath：方法下： </p>
<p>[html lang=”Objective-C”] </p>
<ul>
<li>(UITableViewCell <em>)tableView:(UITableView </em>)tableView cellForRowAtIndexPath:(NSIndexPath <em>)indexPath {<br>   static NSString </em>MyIdentifier = @”MyIdentifier”;<br>   UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:MyIdentifier];<br>  if (cell == nil) {<pre><code><span class="attribute">   cell </span>=<span class="string"> [[[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:MyIdentifier] autorelease];</span>
</code></pre>   }<br>// Here we use the new provided setImageWithURL: method to load the web image<br>  [cell.imageView setImageWithURL:[NSURL URLWithString:@”<a href="http://www.domain.com/path/to/image.jpg" target="_blank">http://www.domain.com/path/to/image.jpg</a>“] placeholderImage:[UIImage imageNamed:@”placeholder.png”]];<br>  cell.textLabel.text = @”My Text”;<br>  return cell;<br>}<br>[/html]</li>
</ul>
<p>基本代码：[imageView setImageWithURL:[NSURL URLWithString:@”<a href="http://www.domain.com/path/image.jpg" target="_blank">http://www.domain.com/path/image.jpg</a>“]];<br>使用SDWebImageManager类：可以进行一些异步加载的工作。<br>[html lang=”Objective-C”]<br>SDWebImageManager <em>manager = [SDWebImageManager sharedManager];<br>UIImage </em>cachedImage = [manager imageWithURL:url]; // 将需要缓存的图片加载进来<br>if (cachedImage) {<br>      // 如果Cache命中，则直接利用缓存的图片进行有关操作<br>      // Use the cached image immediatly<br>} else {<br>      // 如果Cache没有命中，则去下载指定网络位置的图片，并且给出一个委托方法<br>      // Start an async download<br>     [manager downloadWithURL:url delegate:self];<br>}<br>[/html]<br>当然你的类要实现SDWebImageManagerDelegate协议，并且要实现协议的webImageManager:didFinishWithImage:方法。<br>// 当下载完成后，调用回调方法，使下载的图片显示<br>[html lang=”Objective-C”]</p>
<ul>
<li>(void)webImageManager:(SDWebImageManager <em>)imageManager didFinishWithImage:(UIImage </em>)image {<br>  // Do something with the downloaded image<br>}<br>[/html]<br>独立的异步图像下载<br>可能会单独用到异步图片下载，则一定要用downloaderWithURL:delegate:来建立一个SDWebImageDownloader实例。<br>downloader = [SDWebImageDownloader downloaderWithURL:url delegate:self];<br>这样SDWebImageDownloaderDelegate协议的方法imageDownloader:didFinishWithImage:被调用时下载会立即开始并完成。</li>
</ul>
<p>独立的异步图像缓存<br>SDImageCache类提供一个创建空缓存的实例，并用方法imageForKey:来寻找当前缓存。<br>[html lang=”Objective-C”]<br>UIImage *myCachedImage = [[SDImageCache sharedImageCache] imageFromKey:myCacheKey];<br>[/html]</p>
<p>存储一个图像到缓存是使用方法storeImage: forKey:<br>[[SDImageCache sharedImageCache] storeImage:myImage forKey:myCacheKey];<br>默认情况下，图像将被存储在内存缓存和磁盘缓存中。如果仅仅是想内存缓存中，要使用storeImage:forKey:toDisk:方法的第三个参数带一负值<br>来替代。</p>
<p>SDWebImage 支持异步的图片下载+缓存，提供了 UIImageView+WebCacha 的 category，方便使用。纪录一下 SDWebImage 加载图片的流程。<br>入口 setImageWithURL:placeholderImage:options: 会先把 placeholderImage 显示，然后 SDWebImageManager 根据 URL 开始处理图片。<br>进入 SDWebImageManager-downloadWithURL:delegate:options:userInfo:，交给 SDImageCache 从缓存查找图片是否已经下载 queryDiskCacheForKey:delegate:userInfo:.<br>先从内存图片缓存查找是否有图片，如果内存中已经有图片缓存，SDImageCacheDelegate 回调 imageCache:didFindImage:forKey:userInfo: 到 SDWebImageManager。<br>SDWebImageManagerDelegate 回调 webImageManager:didFinishWithImage: 到 UIImageView+WebCache 等前端展示图片。<br>如果内存缓存中没有，生成 NSInvocationOperation 添加到队列开始从硬盘查找图片是否已经缓存。<br>根据 URLKey 在硬盘缓存目录下尝试读取图片文件。这一步是在 NSOperation 进行的操作，所以回主线程进行结果回调 notifyDelegate:。<br>如果上一操作从硬盘读取到了图片，将图片添加到内存缓存中（如果空闲内存过小，会先清空内存缓存）。SDImageCacheDelegate 回调 imageCache:didFindImage:forKey:userInfo:。进而回调展示图片。<br>如果从硬盘缓存目录读取不到图片，说明所有缓存都不存在该图片，需要下载图片，回调 imageCache:didNotFindImageForKey:userInfo:。<br>共享或重新生成一个下载器 SDWebImageDownloader 开始下载图片。<br>图片下载由 NSURLConnection 来做，实现相关 delegate 来判断图片下载中、下载完成和下载失败。<br>connection:didReceiveData: 中利用 ImageIO 做了按图片下载进度加载效果。<br>connectionDidFinishLoading: 数据下载完成后交给 SDWebImageDecoder 做图片解码处理。<br>图片解码处理在一个 NSOperationQueue 完成，不会拖慢主线程 UI。如果有需要对下载的图片进行二次处理，最好也在这里完成，效率会好很多。<br>在主线程 notifyDelegateOnMainThreadWithInfo: 宣告解码完成，imageDecoder:didFinishDecodingImage:userInfo: 回调给 SDWebImageDownloader。<br>imageDownloader:didFinishWithImage: 回调给 SDWebImageManager 告知图片下载完成。<br>通知所有的 downloadDelegates 下载完成，回调给需要的地方展示图片。<br>将图片保存到 SDImageCache 中，内存缓存和硬盘缓存同时保存。写文件到硬盘也在以单独 NSInvocationOperation 完成，避免拖慢主线程。<br>SDImageCache 在初始化的时候会注册一些消息通知，在内存警告或退到后台的时候清理内存图片缓存，应用结束的时候清理过期图片。<br>SDWI 也提供了 UIButton+WebCache 和 MKAnnotationView+WebCache，方便使用。<br>SDWebImagePrefetcher 可以预先下载图片，方便后续使用。</p>
<p>SDWebImage库的作用：<br>通过对UIImageView的类别扩展来实现异步加载替换图片的工作。<br>主要用到的对象：<br>1、UIImageView (WebCache)类别，入口封装，实现读取图片完成后的回调<br>2、SDWebImageManager，对图片进行管理的中转站，记录那些图片正在读取。<br>向下层读取Cache（调用SDImageCache），或者向网络读取对象（调用SDWebImageDownloader） 。<br>实现SDImageCache和SDWebImageDownloader的回调。<br>3、SDImageCache，根据URL的MD5摘要对图片进行存储和读取（实现存在内存中或者存在硬盘上两种实现）<br>实现图片和内存清理工作。<br>4、SDWebImageDownloader，根据URL向网络读取数据（实现部分读取和全部读取后再通知回调两种方式）<br>其他类：<br>SDWebImageDecoder，异步对图像进行了一次解压⋯⋯<br>目前不明白为什么要做这么道工序。（现在清楚了，功能解释见下文）<br>有趣的点：<br>1、SDImageCache是怎么做数据管理的?<br>SDImageCache分两个部分，一个是内存层面的，一个是硬盘层面的。<br>内存层面的相当是个缓存器，以Key-Value的形式存储图片。当内存不够的时候会清除所有缓存图片。<br>用搜索文件系统的方式做管理，文件替换方式是以时间为单位，剔除时间大于一周的图片文件。<br>当SDWebImageManager向SDImageCache要资源时，先搜索内存层面的数据，如果有直接返回，没有的话去访问磁盘，将图片从磁盘读取出来，然后做Decoder，将图片对象放到内存层面做备份，再返回调用层。<br>2、为啥必须做Decoder?<br>通过这个博客：[crayon url=”<a href="http://www.cocoanetics.com/2011/10/avoiding-image-decompression-sickness&quot;]http://www.cocoanetics.com/2011/10/avoiding-image-decompression-sickness/[/crayon" target="_blank">http://www.cocoanetics.com/2011/10/avoiding-image-decompression-sickness&quot;]http://www.cocoanetics.com/2011/10/avoiding-image-decompression-sickness/[/crayon</a>]<br>现在明白了，由于UIImage的imageWithData函数是每次画图的时候才将Data解压成ARGB的图像，<br>所以在每次画图的时候，会有一个解压操作，这样效率很低，但是只有瞬时的内存需求。<br>为了提高效率通过SDWebImageDecoder将包装在Data下的资源解压，然后画在另外一张图片上，这样这张新图片就不再需要重复解压了。<br>这种做法是典型的空间换时间的做法。</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/u/2049029440"><strong>牙-_签</strong></a> - 12月 10 2012</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://toothpick2012.github.io/"><strong>Toothpick&#39;s blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  

  <nav id="pagination">
  
  
</nav>
</div>
    </div>
    <div class="tabbar" onload="divideTabBar()">
	
      <div class="tabbaritem"><a class="next" href="/">首页</a></div>
    
      <div class="tabbaritem"><a class="next" href="/archives/">归档</a></div>
    
      <div class="tabbaritem"><a class="next" href="/about/">关于</a></div>
    
      <div class="tabbaritem"><a class="next" href="/atom.xml">订阅</a></div>
    
</div>


  </div>
</body>
</html>